<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petite-vue MQTT Example</title>
    <script src="petite-vue.global.prod.js"></script>
</head>
<body>
    <div v-scope>
        <h3>Subscribe to a topic</h3>
        <input v-model="topic" placeholder="Enter topic">
        <button v-on:click="subscribe">Subscribe</button>
        <p v-if="subscribed">Subscribed to topic: {{subscribed}}</p>
        <p v-if="error">{{error}}</p>
    </div>
    <div v-scope>
        <h3>Publish a message</h3>
        <input v-model="topic" placeholder="Enter topic">
        <input v-model="payload" placeholder="Enter payload">
        <button v-on:click="publish">Publish</button>
        <p v-if="published">Message published successfully</p>
        <p v-if="error">{{error}}</p>
    </div>

    <script>
    PetiteVue.createApp({
        topic: '',
        payload: '',
        subscribed: '',
        published: false,
        error: '',
        async subscribe() {
            if (!this.topic) {
                this.error = 'Please enter a topic';
                return;
            }

            try {
                const response = await fetch(`/mqtt/subscribe?topic=${encodeURIComponent(this.topic)}`);
                if (response.ok) {
                    this.subscribed = this.topic;
                    this.error = '';
                } else {
                    this.error = 'Error subscribing to topic: ' + (await response.text());
                    this.subscribed = '';
                }
            } catch (err) {
                this.error = 'Error subscribing to topic: ' + err.message;
                this.subscribed = '';
            }
        },
        async publish() {
            if (!this.topic || !this.payload) {
                this.error = 'Please enter a topic and payload';
                return;
            }

            try {
                const response = await fetch(`/mqtt/publish?topic=${encodeURIComponent(this.topic)}&payload=${encodeURIComponent(this.payload)}`);
                if (response.ok) {
                    this.published = true;
                    this.error = '';
                } else {
                    this.error = 'Error publishing message: ' + (await response.text());
                    this.published = false;
                }
            } catch (err) {
                this.error = 'Error publishing message: ' + err.message;
                this.published = false;
            }
        }
    }).mount();
    </script>
</body>
</html>
